# LILA
## 数据处理  
研究使用的是为BattLeDIM（泄漏检测和隔离方法之战）竞赛设计的L-Town网络数据。这些数据是SCADA设备在2018年和2019年以5分钟的时间分辨率报告的，包括来自水库出口的流量计、水箱水位传感器、网络中的33个压力传感器以及DMA C中82个用户级别的自动抄表（AMR）设备的数据 。
## 实现细节  

以下是其详细的实现细节：

### 第一步：LI-1: 线性回归 (Linear Regression)
这一步的核心思想是，在没有泄漏的正常情况下，管网中任意两个传感器节点（例如节点 i 和节点 j）的压力值存在一种稳定的线性关系 [cite: 10, 107]。
理论基础：该关系源于伯努利能量守恒方程 [cite: 119][cite_start]。通过一系列简化和假设（例如，水头损失与流量的平方成正比，而流量又与压力变化相关），复杂的液压关系可以被转换成一个线性回归模型 [cite: 148, 151, 152]。
* [cite_start]**回归模型**：最终，节点 i 的压力 $P_i$ 可以通过节点 j 的压力 $P_j$ 和一些已知的“非常规”需水量（如水泵启动） $Q_d$ 来预测 [cite: 143]。模型简化后的形式为：
    [cite_start]$P_i = k_{ji}^0 + P_j k_{ji}^1 + \sum_{d \in D_{IR}} k_{ji}^d Q_d^2$ [cite: 166]
    [cite_start]其中，$k$ 是通过最小二乘法在无泄漏的正常时期数据上学习到的回归系数 [cite: 171]。
* [cite_start]**实施**：首先，需要手动选择一个确认没有发生泄漏的时间段作为“训练期”或“校准期”，来估计模型中的回归系数 [cite: 171, 1109]。

### 第二步：LI-2: 重建误差分析 (Reconstruction Error Analysis)

[cite_start]当线性模型建立后，就可以用它来持续预测压力。如果网络中发生了新的泄漏，就会导致预测值与实际观测值之间产生偏差 [cite: 175]。

* [cite_start]**模型重建误差 (MRE)**：这个偏差被称为模型重建误差（MRE），其计算公式为观测压力与模型预测压力之差 [cite: 177]：
    [cite_start]$MRE_{ji} = P_i - \hat{P}_i$ [cite: 177]
* **误差特性**：
    * [cite_start]在无泄漏时，MRE 应该在 0 附近波动，呈正态分布 [cite: 181, 182, 204]。
    * [cite_start]当一个泄漏发生时，它会导致额外的水流损失，从而在 MRE 中产生一个持续的、非零的趋势 [cite: 175, 176]。
* [cite_start]**识别最受影响传感器 (MAS)**：论文指出，一个发生在传感器 s 附近的泄漏，会导致所有以 s 作为预测目标（即 $P_s$）的 MRE 序列（如 $MRE_{si}$）都出现**正向**的偏差 [cite: 188]。利用这一特性，可以通过以下公式来确定哪个传感器是受影响最严重的（MAS）：
    [cite_start]$s(t) = \text{arg max}_j \left(\sum_i \text{sign}(MRE_{ji}(t))\right)$ [cite: 190]
    [cite_start]这个公式的含义是，在某个时刻 t，计算每个传感器作为 MAS 时产生的正向误差信号的总和，总和最大的那个传感器就是当前最可能的 MAS [cite: 190]。

### 第三步：LI-3: 变化点检测 (Change Point Detection)

[cite_start]最后一步是对 MRE 时间序列进行分析，以自动、准确地判断泄漏开始的精确时刻 [cite: 199]。

* [cite_start]**所用算法**：LILA 采用了一种在统计过程控制中被广泛使用的 **Cusum 算法** [cite: 207]。
* [cite_start]**算法原理**：Cusum 算法会累积 MRE 值与正常均值（即 0）之间的偏差。当这个累积值超过一个预设的阈值 H 时，就会发出一个“变化点”警报，即认为泄漏已经发生 [cite: 208, 209, 211]。
* [cite_start]**具体公式**：由于泄漏主要导致 MRE 出现正向偏差，因此使用了检测正向变化的 Cusum 公式 [cite: 212]：
    [cite_start]$C_i^+ = \text{max}[0, x_i - (\mu_0 + K) + C_{i-1}^+]$，其中 $C_0^+ = 0$ [cite: 213]
    [cite_start]这里的 $x_i$ 是 MRE 的值，$\mu_0$ 是正常时期的均值（为0），K 是一个基于信号标准差计算出的松弛值 [cite: 209, 215]。
* [cite_start]**实施**：该算法以在线方式运行，逐个分析新的 MRE 数据点，从而实现对泄漏的及时检测 [cite: 107, 550][cite_start]。为了应对管网中不同区域的噪声水平，算法的超参数（如 K 和 H 的设定）需要根据具体情况进行调整。例如，在需水量不规律、噪声大的区域，阈值需要设置得更高以避免误报 [cite: 1249, 1250]。

[cite_start]通过这三个步骤的顺序执行，LILA 的泄漏识别模块能够完成从数据处理、异常发现到最终报警的整个自动化流程 [cite: 9]。
